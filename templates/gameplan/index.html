{% extends "gameplan/base.html" %}

{% block head %}
    <script>
        $(document).ready(function () {

        });

        function getContentRecommendations(gameName) {
            url = '/recommender/content-based/' + gameName + '/';
            queryName = 'contentRec';
            fetchRecommendations(url, queryName);
        }

        function fetchRecommendations(url, queryName) {
            $.getJSON(url, function (result) {
                removeGames(queryName);
                if (result.data != null && result.data.length > 0) {
                    recommendations = document.getElementById(queryName);
                    recommendations.style.display = 'block';

                    $('#similarHeading').text("Similar to " + $('#inputGameName').val());
                    result.data.forEach(function (element, index, array) {
                        addGame(element, recommendations)
                    });
                }
            });
        }

        function addGame(game, results) {
            itemDiv = document.createElement('div');
            itemDiv.setAttribute('class', "col-sm-2 img-responsive item");

            itemLink = document.createElement('a');
            itemLink.setAttribute('href', '/games/game/' + game['game_id']);

            itemImage = document.createElement('img');
            itemImage.setAttribute('class', "img-responsive");
            itemImage.setAttribute('title', game['title']);
            itemLink.appendChild(itemImage);

            itemDiv.appendChild(itemLink);

            results.appendChild(itemDiv);
        }

        function removeGames(queryName) {
            document.getElementById(queryName).style.display = 'None';
            document.getElementById('similarHeading').style.display = 'None';
            $('.item').remove()
        }
    </script>
{% endblock head %}

{% block content %}
    <h1>Game Recommender</h1>

    <form>
        <div class="form-group">
            <label for="inputGameName">Game name</label>
            <input type="text" class="form-control input-lg" id="inputGameName" aria-describedby="gameHelp"
                   placeholder="Enter game name">
            <small id="gameHelp" class="form-text text-muted">We'll generate some recommendations as you type.</small>
        </div>
    </form>

    <div id="contentRec" class="row" style="display: none">
        <h2 id="similarHeading">Similar to </h2>
    </div>

    <script type="text/javascript">
        $('#inputGameName').on('input', function () {
            getContentRecommendations($('#inputGameName').val())
        });
    </script>
{% endblock content %}
